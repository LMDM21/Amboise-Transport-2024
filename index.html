<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calcul des Horaires de Bus</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Roboto', sans-serif;
            background-color: #f0f0f0;
            color: #333;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: flex-start;
        }
        .container, .instructions-container, .clock-container {
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            margin: 0 10px;
            max-width: 600px;
        }
        .clock-container {
            font-size: 2rem;
            text-align: center;
            margin-bottom: 20px;
        }
        .container, .instructions-container {
            flex-grow: 1;
            margin: 0 10px;
        }
        input, select {
            padding: 10px;
            font-size: 16px;
            margin: 10px 0;
            border-radius: 5px;
            border: 1px solid #ccc;
            width: calc(100% - 22px);
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        table, th, td {
            border: 1px solid #ccc;
        }
        th, td {
            padding: 10px;
            text-align: center;
        }
        @media (max-width: 600px) {
            body {
                flex-direction: column;
                align-items: center;
            }
            .container, .instructions-container, .clock-container {
                margin: 0;
            }
        }
    </style>
</head>
<body>
    
        <div class="clock-container">
            <div id="clock"></div>
        </div>
        <div class="container">
            <h1>Calcul des Horaires de Bus</h1>
            <p>Entrez l'heure de début du chauffeur :</p>
            <input type="time" id="startTime">
            
            <p>Sélectionnez votre ligne :</p>
            <select id="lineSelect">
                <option value="">--Sélectionner une ligne--</option>
                <option value="ligne1">Ligne 1</option>
                <option value="ligne2">Ligne 2</option>
                <option value="ligne3">Ligne 3</option>
            </select>
            
            <button onclick="calculateSchedule()">Calculer les Horaires</button>
            <button onclick="resetSchedule()">Annuler la Ligne</button>
            
            <input type="checkbox" id="muteSound">
            <label for="muteSound">Activer/Désactiver le Son</label>

            <div class="result" style="max-height: 400px; overflow-y: auto;">
                <table id="scheduleTable">
                    <thead>
                        <tr>
                            <th>Nom de l'arrêt</th>
                            <th>Arrivée à l'arrêt</th>
                            <th>Départ de l'arrêt</th>
                        </tr>
                    </thead>
                    <tbody id="scheduleBody"></tbody>
                </table>
            </div>
        </div>

        <div class="instructions-container">
            <h2>Instructions</h2>
            <p>1. Entrez l'heure de début du chauffeur dans le champ prévu.</p>
            <p>2. Sélectionnez la ligne de bus parmi les options disponibles.</p>
            <p>3. Cliquez sur "Calculer les Horaires" pour générer le tableau des horaires.</p>
            <p>4. Consultez le tableau des horaires pour voir les heures d'arrivée et de départ aux différents arrêts.</p>
        </div>

    <script>
        const PAUSE_TIME = 30; // Temps de pause en secondes (30 secondes)

        const lines = {
            'ligne1': [
                { name: 'Gare Routière', duration: 15, arrivalSound: 'https://drive.google.com/file/d/1tsIg1olZfMsg_6L5kz13kwa11c_eQrS5/view?usp=sharing', departureSound: 'https://drive.google.com/file/d/1fLD5Sb5zdX5ix0o_D8BwrFhMeGfjYGyM/view?usp=sharing' },
                { name: 'Hôpital St Boise', duration: 30, arrivalSound: 'https://drive.google.com/file/d/1tsIg1olZfMsg_6L5kz13kwa11c_eQrS5/view?usp=sharing', departureSound: 'https://drive.google.com/file/d/1fLD5Sb5zdX5ix0o_D8BwrFhMeGfjYGyM/view?usp=sharing' },
                { name: 'Concessionnaire', duration: 45, arrivalSound: 'https://drive.google.com/file/d/1tsIg1olZfMsg_6L5kz13kwa11c_eQrS5/view?usp=sharing', departureSound: 'https://drive.google.com/file/d/1fLD5Sb5zdX5ix0o_D8BwrFhMeGfjYGyM/view?usp=sharing' },
                { name: 'Quartier des Tilleuls', duration: 30, arrivalSound: 'sounds/arrival.mp3', departureSound: 'sounds/departure.mp3' },
                { name: 'Amboise Nord Centre', duration: 30, arrivalSound: 'sounds/arrival.mp3', departureSound: 'sounds/departure.mp3' },
                { name: 'Circuit Karting', duration: 30, arrivalSound: 'sounds/arrival.mp3', departureSound: 'sounds/departure.mp3' },
                { name: 'Garage Karting', duration: 30, arrivalSound: 'sounds/arrival.mp3', departureSound: 'sounds/departure.mp3' },
                { name: 'Dépôt des Routiers', duration: 30, arrivalSound: 'sounds/arrival.mp3', departureSound: 'sounds/departure.mp3' },
                { name: 'Magasin de vêtements', duration: 30, arrivalSound: 'sounds/arrival.mp3', departureSound: 'sounds/departure.mp3' },
                { name: 'Z.I Fuye 1', duration: 30, arrivalSound: 'sounds/arrival.mp3', departureSound: 'sounds/departure.mp3' },
                { name: 'La Fuye Centre', duration: 30, arrivalSound: 'sounds/arrival.mp3', departureSound: 'sounds/departure.mp3' },
                { name: 'La Reigneire', duration: 30, arrivalSound: 'sounds/arrival.mp3', departureSound: 'sounds/departure.mp3' },
                { name: 'UFO Grill', duration: 30, arrivalSound: 'sounds/arrival.mp3', departureSound: 'sounds/departure.mp3' },
                { name: 'Z.I La Fuye 3', duration: 30, arrivalSound: 'sounds/arrival.mp3', departureSound: 'sounds/departure.mp3' },
                { name: 'Domaine Viticole', duration: 30, arrivalSound: 'sounds/arrival.mp3', departureSound: 'sounds/departure.mp3' },
                { name: 'Camp de Bucheron', duration: 30, arrivalSound: 'sounds/arrival.mp3', departureSound: 'sounds/departure.mp3' },
                { name: 'Déchetterie', duration: 30, arrivalSound: 'sounds/arrival.mp3', departureSound: 'sounds/departure.mp3' },
                { name: 'Gare Routière', duration: 30, arrivalSound: 'sounds/arrival.mp3', departureSound: 'sounds/departure.mp3' }
            ],
            'ligne2': [
                { name: 'Arrêt X', duration: 15, arrivalSound: 'https://drive.google.com/file/d/1tsIg1olZfMsg_6L5kz13kwa11c_eQrS5/view?usp=sharing', departureSound: 'sounds/departure.mp3' },
                { name: 'Arrêt Y', duration: 20, arrivalSound: 'sounds/arrival.mp3', departureSound: 'sounds/departure.mp3' },
                { name: 'Arrêt Z', duration: 20, arrivalSound: 'sounds/arrival.mp3', departureSound: 'sounds/departure.mp3' }
            ],
            'ligne3': [
                { name: 'Arrêt P', duration: 25 },
                { name: 'Arrêt Q', duration: 20 },
                { name: 'Arrêt R', duration: 30 }
            ]
        };

        let timeoutIds = []; // Stocker les identifiants de timeout pour les sons

        function calculateSchedule() {
            resetSchedule();
            var startTime = document.getElementById('startTime').value;
            var lineSelect = document.getElementById('lineSelect').value;
            
            if (!startTime || !lineSelect) {
                alert('Veuillez entrer l\'heure de début et sélectionner une ligne.');
                return;
            }

            var line = lines[lineSelect];
            var currentDate = new Date();
            var startHours = parseInt(startTime.split(':')[0]);
            var startMinutes = parseInt(startTime.split(':')[1]);
            currentDate.setHours(startHours);
            currentDate.setMinutes(startMinutes);
            currentDate.setSeconds(0); // Set seconds to zero

            var scheduleBody = document.getElementById('scheduleBody');
            scheduleBody.innerHTML = ''; // Clear previous results

            for (var i = 0; i < line.length; i++) {
    var row = document.createElement('tr');
    var stop = line[i];
    var stopName = stop.name;
    var duration = stop.duration;

    var arriveTime = new Date(currentDate);
    if (i > 0) {
        arriveTime.setSeconds(arriveTime.getSeconds() + line[i - 1].duration); // Add duration from previous stop
    } else {
        arriveTime.setHours(startHours);
        arriveTime.setMinutes(startMinutes);
        arriveTime.setSeconds(0);
    }

    var departTime = new Date(arriveTime);
    departTime.setSeconds(departTime.getSeconds() + PAUSE_TIME); // Add pause time in seconds

    var cellName = document.createElement('td');
    cellName.textContent = stopName;
    var cellArrive = document.createElement('td');
    cellArrive.textContent = formatTime(arriveTime);
    var cellDepart = document.createElement('td');
    cellDepart.textContent = formatTime(departTime);

    row.appendChild(cellName);
    row.appendChild(cellArrive);
    row.appendChild(cellDepart);
    scheduleBody.appendChild(row);

    // Play arrival sound
    let arriveTimeoutId = setTimeout(function() {
        if (!document.getElementById('muteSound').checked) {
            var audio = new Audio(stop.arrivalSound);
            audio.play();
        }
    }, arriveTime.getTime() - Date.now()); // Play sound at arrival time
    timeoutIds.push(arriveTimeoutId); // Store timeout ID

    // Play departure sound
    let departTimeoutId = setTimeout(function() {
        if (!document.getElementById('muteSound').checked) {
            var audio = new Audio(stop.departureSound);
            audio.play();
        }
    }, departTime.getTime() - Date.now()); // Play sound at departure time
    timeoutIds.push(departTimeoutId); // Store timeout ID

    currentDate = departTime;
}

        } 

        function resetSchedule() {
            // Clear the schedule table
            var scheduleBody = document.getElementById('scheduleBody');
            scheduleBody.innerHTML = '';

            // Clear all previous timeouts
            timeoutIds.forEach(id => clearTimeout(id));
            timeoutIds = [];
        }

        function formatTime(date) {
            return date.getHours().toString().padStart(2, '0') + ':' +
                date.getMinutes().toString().padStart(2, '0') + ':' +
                date.getSeconds().toString().padStart(2, '0');
        }

        function updateClock() {
            var now = new Date();
            var options = { timeZone: 'Europe/Paris', hour: '2-digit', minute: '2-digit', second: '2-digit' };
            var timeString = now.toLocaleTimeString('fr-FR', options);
            document.getElementById('clock').textContent = timeString;
        }

        setInterval(updateClock, 1000); // Update clock every second
        updateClock(); // Initial update
    </script>
</body>
</html>
